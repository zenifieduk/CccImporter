---
pagination:
  data: collections.events
  size: 1
  alias: event
permalink: "/events/{{ event.eventSlug }}/"
---

{% set title = event.eventTitle + " | Classic Car Events UK" %}
{% set description = event.eventDescription or "Details about " + event.eventTitle + ", a classic car event in the UK." %}

<div class="container">
  <div class="breadcrumb-container">
    {% set breadcrumbs = [
      { text: "Club Events", url: "/club-events/" },
      { text: event.eventTitle }
    ] %}
    {% include "components/breadcrumb.njk" %}
  </div>
  
  <div class="event-header">
    <div class="event-category-tags">
      {% for category in event.eventCategory %}
        <span class="event-category-tag">{{ category }}</span>
      {% endfor %}
    </div>
    
    <h1 class="event-title">{{ event.eventTitle }}</h1>
    
    {% if event.eventFeatured %}
      <div class="featured-badge-large">Featured Event</div>
    {% endif %}
  </div>
  
  <div class="event-detail-layout">
    <div class="event-detail-main">
      <div class="event-detail-image">
        {% if event.eventImageUrl %}
          {% image event.eventImageUrl, event.eventTitle, "(min-width: 768px) 600px, 100vw", "event-detail-img" %}
        {% else %}
          <div class="event-detail-image-placeholder">Event image not available</div>
        {% endif %}
      </div>
      
      <section class="event-about">
        <h2 class="section-title">About This Event</h2>
        <p>{{ event.eventDescription }}</p>
      </section>
      
      <section class="event-details">
        <h2 class="section-title">Event Details</h2>
        <div class="event-details-grid">
          <div class="detail-item">
            <div class="detail-label">
              <i data-feather="calendar"></i> Date and Time
            </div>
            <div class="detail-value">
              <div>{{ event.eventStartDateTime | formatDate }}</div>
              {% if event.eventEndDateTime %}
                <div>to {{ event.eventEndDateTime | formatDate }}</div>
              {% endif %}
            </div>
          </div>
          
          <div class="detail-item">
            <div class="detail-label">
              <i data-feather="map-pin"></i> Location
            </div>
            <div class="detail-value">
              {% if event.eventAddress %}
                <div>{{ event.eventAddress }}</div>
                {% if event.eventState %}
                  <div>{{ event.eventState }}</div>
                {% endif %}
              {% else %}
                <div>{{ event.eventCity }}{% if event.eventState %}, {{ event.eventState }}{% endif %}</div>
              {% endif %}
              {% if event.eventPostalCode %}
                <div>{{ event.eventPostalCode }}</div>
              {% endif %}
            </div>
          </div>
          
          <div class="detail-item">
            <div class="detail-label">
              <i data-feather="tag"></i> Price
            </div>
            <div class="detail-value">
              {{ event.eventTicketPrice or "Free entry" }}
            </div>
          </div>
          
          {% if event.eventCategory %}
            <div class="detail-item">
              <div class="detail-label">
                <i data-feather="list"></i> Categories
              </div>
              <div class="detail-value categories-list">
                {% for category in event.eventCategory %}
                  <span class="category-pill">{{ category }}</span>
                {% endfor %}
              </div>
            </div>
          {% endif %}
        </div>
      </section>
      
      {% if event.eventMaps %}
        <section class="event-map">
          <h2 class="section-title">Location Map</h2>
          <div class="map-container">
            {{ event.eventMaps | safe }}
          </div>
        </section>
      {% else %}
        <section class="event-map">
          <h2 class="section-title">Location Map</h2>
          <div class="map-container">
            <div class="map-placeholder">
              <i data-feather="map" class="map-icon"></i>
              <div>
                <p>Map location details unavailable.</p>
                <p>Please check the address details above.</p>
              </div>
            </div>
          </div>
        </section>
      {% endif %}
      
      {% set relatedEvents = collections.events | filterByCategory(event.eventCategory[0]) | limitWithout(3, event.eventSlug) %}
      {% if relatedEvents.length > 0 %}
        <section class="related-events">
          <h2 class="section-title">Similar Events</h2>
          <div class="grid grid-small">
            {% for relatedEvent in relatedEvents %}
              {% include "components/event-card.njk" with {event: relatedEvent} %}
            {% endfor %}
          </div>
        </section>
      {% endif %}
    </div>
    
    <div class="event-detail-sidebar">
      <div class="event-cta-card">
        <div class="event-date-large">
          <div class="event-day">{{ event.eventStartDateTime | shortDate }}</div>
          <div class="event-month-year">{{ event.eventStartDateTime | extractMonth }} {{ event.eventStartDateTime | extractYear }}</div>
        </div>
        
        {% if event.eventWebsite %}
          <a href="{{ event.eventWebsite }}" target="_blank" rel="noopener" class="btn visit-website-btn">
            <i data-feather="external-link"></i> Visit Website
          </a>
        {% endif %}
        
        <a href="#" class="btn btn-secondary add-calendar-btn" id="addToCalendarBtn">
          <i data-feather="calendar"></i> Add to Calendar
        </a>
        
        <div class="calendar-dropdown" id="calendarDropdown">
          <a href="#" class="calendar-option" data-calendar="google">Google Calendar</a>
          <a href="#" class="calendar-option" data-calendar="outlook">Outlook</a>
          <a href="#" class="calendar-option" data-calendar="apple">Apple Calendar</a>
        </div>
      </div>
      
      <div class="event-info-card">
        <h2 class="info-card-title">Organizer</h2>
        
        <div class="organizer-info">
          {% if event.eventOrganizer %}
            <div class="info-item">
              <i data-feather="users" class="info-icon"></i>
              <div>
                <div class="info-label">Organized by</div>
                <div class="info-value">{{ event.eventOrganizer }}</div>
              </div>
            </div>
          {% endif %}
          
          {% if event.eventPhone %}
            <div class="info-item">
              <i data-feather="phone" class="info-icon"></i>
              <div>
                <div class="info-label">Phone</div>
                <div class="info-value">{{ event.eventPhone }}</div>
              </div>
            </div>
          {% endif %}
          
          {% if event.eventEmail %}
            <div class="info-item">
              <i data-feather="mail" class="info-icon"></i>
              <div>
                <div class="info-label">Email</div>
                <a href="mailto:{{ event.eventEmail }}" class="info-value">{{ event.eventEmail }}</a>
              </div>
            </div>
          {% endif %}
        </div>
        
        <div class="event-share">
          <h3 class="share-title">Share This Event</h3>
          <div class="share-buttons">
            <a href="https://www.facebook.com/sharer/sharer.php?u={{ site.url }}/events/{{ event.eventSlug }}/" target="_blank" rel="noopener" class="share-button facebook">
              <i data-feather="facebook"></i>
            </a>
            <a href="https://twitter.com/intent/tweet?url={{ site.url }}/events/{{ event.eventSlug }}/&text={{ event.eventTitle }}" target="_blank" rel="noopener" class="share-button twitter">
              <i data-feather="twitter"></i>
            </a>
            <a href="mailto:?subject={{ event.eventTitle }}&body=Check out this event: {{ site.url }}/events/{{ event.eventSlug }}/" class="share-button email">
              <i data-feather="mail"></i>
            </a>
          </div>
        </div>
      </div>
      
      <div class="get-directions-card">
        <h3 class="directions-title">Get Directions</h3>
        <a href="https://www.google.com/maps/search/?api=1&query={{ event.eventAddress | urlencode }}" target="_blank" rel="noopener" class="btn btn-secondary directions-btn">
          <i data-feather="navigation"></i> Open in Google Maps
        </a>
      </div>
    </div>
  </div>
</div>

<link rel="stylesheet" href="/assets/css/event-detail.css">

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const addToCalendarBtn = document.getElementById('addToCalendarBtn');
    const calendarDropdown = document.getElementById('calendarDropdown');
    
    if (addToCalendarBtn && calendarDropdown) {
      addToCalendarBtn.addEventListener('click', function(e) {
        e.preventDefault();
        calendarDropdown.classList.toggle('active');
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', function(e) {
        if (!e.target.closest('#addToCalendarBtn') && !e.target.closest('#calendarDropdown')) {
          calendarDropdown.classList.remove('active');
        }
      });
      
      // Calendar option clicks
      const calendarOptions = document.querySelectorAll('.calendar-option');
      calendarOptions.forEach(option => {
        option.addEventListener('click', function(e) {
          e.preventDefault();
          const calendarType = this.dataset.calendar;
          
          // Event details
          const title = '{{ event.eventTitle }}';
          const start = '{{ event.eventStartDateTime }}';
          const end = '{{ event.eventEndDateTime }}';
          const location = '{{ event.eventAddress }}';
          const description = '{{ event.eventDescription }}';
          
          // Create calendar links (simplified implementation)
          let calendarUrl = '#';
          
          if (calendarType === 'google') {
            calendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${formatCalendarDate(start)}/${formatCalendarDate(end)}&location=${encodeURIComponent(location)}&details=${encodeURIComponent(description)}`;
          } else if (calendarType === 'outlook') {
            calendarUrl = `https://outlook.office.com/calendar/0/deeplink/compose?subject=${encodeURIComponent(title)}&location=${encodeURIComponent(location)}&body=${encodeURIComponent(description)}&startdt=${formatCalendarDate(start)}&enddt=${formatCalendarDate(end)}`;
          } else if (calendarType === 'apple') {
            // For Apple Calendar, typically an .ics file would be generated
            // This is a simplified implementation
            calendarUrl = `data:text/calendar;charset=utf-8,BEGIN:VCALENDAR%0AVERSION:2.0%0ABEGIN:VEVENT%0ADTSTART:${formatCalendarDate(start)}%0ADTEND:${formatCalendarDate(end)}%0ASUMMARY:${encodeURIComponent(title)}%0ALOCATION:${encodeURIComponent(location)}%0ADESCRIPTION:${encodeURIComponent(description)}%0AEND:VEVENT%0AEND:VCALENDAR`;
          }
          
          // Open calendar link in new tab
          window.open(calendarUrl, '_blank');
          
          // Hide dropdown
          calendarDropdown.classList.remove('active');
        });
      });
    }
    
    // Helper function to format date for calendar links
    function formatCalendarDate(dateTimeString) {
      if (!dateTimeString) return '';
      
      try {
        // Parse the date string (format: DDMMYYYY:HH:MM:SS)
        const day = dateTimeString.substring(0, 2);
        const month = dateTimeString.substring(2, 4);
        const year = dateTimeString.substring(4, 8);
        const time = dateTimeString.substring(9).replace(/:/g, '');
        
        // Format for calendar APIs (YYYYMMDDTHHMMSS)
        return `${year}${month}${day}T${time}`;
      } catch (error) {
        console.error('Error formatting calendar date:', error);
        return '';
      }
    }
  });
</script>
